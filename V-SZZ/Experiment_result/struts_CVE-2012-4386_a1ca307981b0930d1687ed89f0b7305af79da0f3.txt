f0d11d7c1d (Musachy Barroso 2009-04-01 18:20:01 +0000 260)                 if (TokenHelper.getToken() != null) {
f0d11d7c1d (Musachy Barroso 2009-04-01 18:20:01 +0000 261)                     session.put(TokenHelper.getTokenName(), TokenHelper.getToken());
c01d3a92db src/test/com/opensymphony/webwork/util/TokenHelperTest.java (Donald J. Brown 2006-03-23 22:10:58 +0000 44)         assertEquals(token, session.get(TokenHelper.DEFAULT_TOKEN_NAME));
c01d3a92db src/test/com/opensymphony/webwork/util/TokenHelperTest.java (Donald J. Brown 2006-03-23 22:10:58 +0000 50)         assertEquals(token, session.get(tokenName));
c01d3a92db src/test/com/opensymphony/webwork/util/TokenHelperTest.java (Donald J. Brown 2006-03-23 22:10:58 +0000 53)     public void testValidToken() {
c01d3a92db src/test/com/opensymphony/webwork/util/TokenHelperTest.java (Donald J. Brown 2006-03-23 22:10:58 +0000 56)         assertEquals(token, session.get(tokenName));
c01d3a92db src/java/com/opensymphony/webwork/util/TokenHelper.java (Donald J. Brown 2006-03-23 22:10:58 +0000 61)     /**
c01d3a92db src/java/com/opensymphony/webwork/util/TokenHelper.java (Donald J. Brown 2006-03-23 22:10:58 +0000 62)      * Sets a transaction token into the session using the provided token name.
c01d3a92db src/java/com/opensymphony/webwork/util/TokenHelper.java (Donald J. Brown 2006-03-23 22:10:58 +0000 63)      *
c01d3a92db src/java/com/opensymphony/webwork/util/TokenHelper.java (Donald J. Brown 2006-03-23 22:10:58 +0000 64)      * @param tokenName the name to store into the session with the token as the value
c01d3a92db src/java/com/opensymphony/webwork/util/TokenHelper.java (Donald J. Brown 2006-03-23 22:10:58 +0000 65)      * @return the token string
c01d3a92db src/java/com/opensymphony/webwork/util/TokenHelper.java (Donald J. Brown 2006-03-23 22:10:58 +0000 66)      */
c01d3a92db src/java/com/opensymphony/webwork/util/TokenHelper.java (Donald J. Brown 2006-03-23 22:10:58 +0000 67)     public static String setToken(String tokenName) {
c01d3a92db src/java/com/opensymphony/webwork/util/TokenHelper.java (Donald J. Brown 2006-03-23 22:10:58 +0000 68)         Map session = ActionContext.getContext().getSession();
7a0a6d5801 (Donald J. Brown 2006-09-10 05:28:16 +0000 69)         String token = generateGUID();
c01d3a92db src/java/com/opensymphony/webwork/util/TokenHelper.java (Donald J. Brown 2006-03-23 22:10:58 +0000 70)         try {
1181c3d502 (Ted Nathan Husted 2006-11-06 15:01:43 +0000 71)             session.put(tokenName, token);
c01d3a92db src/java/com/opensymphony/webwork/util/TokenHelper.java (Donald J. Brown 2006-03-23 22:10:58 +0000 73)         catch(IllegalStateException e) {
1181c3d502 (Ted Nathan Husted 2006-11-06 15:01:43 +0000 75)             String msg = "Error creating HttpSession due response is commited to client. You can use the CreateSessionInterceptor or create the HttpSession from your action before the result is rendered to the client: " + e.getMessage();
1181c3d502 (Ted Nathan Husted 2006-11-06 15:01:43 +0000 76)             LOG.error(msg, e);
1181c3d502 (Ted Nathan Husted 2006-11-06 15:01:43 +0000 77)             throw new IllegalArgumentException(msg);
c01d3a92db src/java/com/opensymphony/webwork/util/TokenHelper.java (Donald J. Brown 2006-03-23 22:10:58 +0000 80)         return token;
c01d3a92db src/java/com/opensymphony/webwork/util/TokenHelper.java (Donald J. Brown 2006-03-23 22:10:58 +0000 84)     /**
c01d3a92db src/java/com/opensymphony/webwork/util/TokenHelper.java (Donald J. Brown 2006-03-23 22:10:58 +0000 85)      * Gets a transaction token into the session using the default token name.
c01d3a92db src/java/com/opensymphony/webwork/interceptor/TokenSessionStoreInterceptor.java (Donald J. Brown 2006-03-23 22:10:58 +0000 124)             ActionInvocation savedInvocation = InvocationSessionStore.loadInvocation(tokenName, token);
c01d3a92db src/java/com/opensymphony/webwork/interceptor/TokenSessionStoreInterceptor.java (Donald J. Brown 2006-03-23 22:10:58 +0000 160)         InvocationSessionStore.storeInvocation(key, token, invocation);
c01d3a92db src/test/com/opensymphony/webwork/views/jsp/ui/TokenTagTest.java (Donald J. Brown 2006-03-23 22:10:58 +0000 66)         assertTrue(s.indexOf("name=\"" + TokenHelper.DEFAULT_TOKEN_NAME) > -1);
c01d3a92db src/test/com/opensymphony/webwork/views/jsp/ui/TokenTagTest.java (Donald J. Brown 2006-03-23 22:10:58 +0000 90)             assertNotNull(token);
c01d3a92db src/test/com/opensymphony/webwork/views/jsp/ui/TokenTagTest.java (Donald J. Brown 2006-03-23 22:10:58 +0000 91)             assertEquals(token, pageContext.getSession().getAttribute(tokenName));
